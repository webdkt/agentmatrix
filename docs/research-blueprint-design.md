# ç ”ç©¶è“å›¾ï¼ˆResearch Blueprintï¼‰è®¾è®¡æ–‡æ¡£

## æ¦‚è¿°

Planning Stage çš„äº§å‡ºæ˜¯ä¸€ä¸ª**ç ”ç©¶è“å›¾ï¼ˆResearch Blueprintï¼‰**ï¼ŒåŒ…å«ä¸‰ä¸ªéƒ¨åˆ†ï¼š

1. **Blueprint Overview** - è‡ªç”±æ–‡æœ¬ï¼Œè®°å½•ç ”ç©¶æƒ³æ³•å’Œæ€è·¯
2. **Research Plan** - ä»»åŠ¡åˆ—è¡¨ï¼ˆtodo listï¼‰ï¼Œæ˜ç¡®ç ”ç©¶æ­¥éª¤
3. **Chapter Outline** - ç« èŠ‚å¤§çº²ï¼ˆheading one åˆ—è¡¨ï¼‰ï¼Œè§„åˆ’æŠ¥å‘Šç»“æ„

## æ•°æ®ç»“æ„

### ResearchContext å­—æ®µ

```python
# Research Blueprint - ç ”ç©¶è“å›¾ï¼ˆPlanning Stage äº§å‡ºï¼‰
self.blueprint_overview = None  # è‡ªç”±æ–‡æœ¬ï¼Œè®°å½•ç ”ç©¶æƒ³æ³•å’Œæ€è·¯
self.research_plan = None  # ä»»åŠ¡åˆ—è¡¨ (task/todo list) - List[str]
self.chapter_outline = None  # ç« èŠ‚å¤§çº² (heading one åˆ—è¡¨) - List[str]
```

### ä¸‰ä¸ªéƒ¨åˆ†çš„æ ¼å¼

#### 1. Blueprint Overviewï¼ˆç ”ç©¶è“å›¾æ¦‚è§ˆï¼‰
- **æ ¼å¼**ï¼šè‡ªç”±æ–‡æœ¬
- **ç”¨é€”**ï¼šè®°å½•ç ”ç©¶çš„æ•´ä½“æ€è·¯ã€æƒ³æ³•ã€æ–¹å‘
- **æ ¡éªŒ**ï¼šåªåšéç©ºæ£€æŸ¥
- **ç¤ºä¾‹**ï¼š
```
æœ¬ç ”ç©¶æ—¨åœ¨æ¢ç´¢å¤§è¯­è¨€æ¨¡å‹åœ¨ä»£ç å®¡æŸ¥åœºæ™¯ä¸­çš„åº”ç”¨ã€‚ä¸»è¦å…³æ³¨ç‚¹åŒ…æ‹¬ï¼š
1. LLM èƒ½å¦å‡†ç¡®è¯†åˆ«ä»£ç ä¸­çš„å®‰å…¨æ¼æ´
2. LLM çš„ä»£ç å®¡æŸ¥å»ºè®®æ˜¯å¦ä¸äººç±»ä¸“å®¶ä¸€è‡´
3. å¦‚ä½•ä¼˜åŒ– prompt ä»¥æé«˜å®¡æŸ¥è´¨é‡
```

#### 2. Research Planï¼ˆç ”ç©¶è®¡åˆ’ï¼‰
- **æ ¼å¼**ï¼šä»»åŠ¡åˆ—è¡¨ï¼Œæ¯è¡Œä¸€ä¸ªä»»åŠ¡
- **ç”¨é€”**ï¼šæ˜ç¡®ç ”ç©¶çš„æ­¥éª¤å’Œé¡ºåºï¼ˆtodo listï¼‰
- **æ ¡éªŒ**ï¼šè‡³å°‘ 2 ä¸ªä»»åŠ¡
- **ç¤ºä¾‹**ï¼š
```
æœç´¢ç›¸å…³æ–‡çŒ®å’Œæ¡ˆä¾‹ç ”ç©¶
è®¾è®¡å®éªŒæ–¹æ¡ˆ
æ”¶é›†å¼€æºä»£ç æ•°æ®é›†
ä½¿ç”¨ä¸åŒ LLM è¿›è¡Œä»£ç å®¡æŸ¥å®éªŒ
å¯¹æ¯”åˆ†æ LLM ä¸äººç±»ä¸“å®¶çš„å®¡æŸ¥ç»“æœ
æ€»ç»“å‘ç°å¹¶æ’°å†™æŠ¥å‘Š
```

#### 3. Chapter Outlineï¼ˆç« èŠ‚å¤§çº²ï¼‰
- **æ ¼å¼**ï¼šHeading one åˆ—è¡¨ï¼Œæ¯è¡Œä»¥ `#` å¼€å¤´
- **ç”¨é€”**ï¼šè§„åˆ’æœ€ç»ˆæŠ¥å‘Šçš„ç« èŠ‚ç»“æ„
- **æ ¡éªŒ**ï¼š
  - æ¯è¡Œå¿…é¡»ä»¥ `#` å¼€å¤´
  - è‡³å°‘ 2 ä¸ªç« èŠ‚
- **ç¤ºä¾‹**ï¼š
```
# å¼•è¨€
# æ–‡çŒ®ç»¼è¿°
# ç ”ç©¶æ–¹æ³•
# å®éªŒç»“æœ
# è®¨è®º
# ç»“è®º
```

## å¯¹åº”çš„ Actions

### 1. save_blueprint_overview

```python
@register_action(
    description="ä¿å­˜ç ”ç©¶è“å›¾æ¦‚è§ˆï¼ˆè‡ªç”±æ–‡æœ¬ï¼Œè®°å½•ç ”ç©¶æƒ³æ³•å’Œæ€è·¯ï¼‰"
)
async def save_blueprint_overview(self, overview: str) -> str:
    """
    ä¿å­˜ç ”ç©¶è“å›¾æ¦‚è§ˆ

    - æ ¼å¼ï¼šè‡ªç”±æ–‡æœ¬
    - æ ¡éªŒï¼šéç©ºæ£€æŸ¥
    - ä¿å­˜åˆ°ï¼šctx.blueprint_overview
    """
```

**ç‰¹ç‚¹**ï¼š
- âœ… è‡ªç”±æ–‡æœ¬ï¼Œæ— æ ¼å¼é™åˆ¶
- âœ… åªåšéç©ºæ£€æŸ¥
- âœ… ä¸åšè¯­ä¹‰è´¨é‡æ£€æŸ¥ï¼ˆç”±å¯¼å¸ˆè´Ÿè´£ï¼‰

### 2. save_research_plan

```python
@register_action(
    description="ä¿å­˜ç ”ç©¶è®¡åˆ’ï¼ˆä»»åŠ¡åˆ—è¡¨æ ¼å¼ï¼šæ¯è¡Œä¸€ä¸ªä»»åŠ¡ï¼‰"
)
async def save_research_plan(self, tasks: str) -> str:
    """
    ä¿å­˜ç ”ç©¶è®¡åˆ’ï¼ˆä»»åŠ¡åˆ—è¡¨ï¼‰

    - æ ¼å¼ï¼šä»»åŠ¡åˆ—è¡¨ï¼Œæ¯è¡Œä¸€ä¸ªä»»åŠ¡
    - æ ¡éªŒï¼šè‡³å°‘ 2 ä¸ªä»»åŠ¡
    - ä¿å­˜åˆ°ï¼šctx.research_plan (List[str])
    """
```

**ç‰¹ç‚¹**ï¼š
- âœ… Todo list æ ¼å¼
- âœ… è‡³å°‘ 2 ä¸ªä»»åŠ¡
- âœ… è‡ªåŠ¨è§£æä¸ºåˆ—è¡¨
- âœ… åªåšæ ¼å¼æ ¡éªŒï¼Œä¸åšè¯­ä¹‰æ£€æŸ¥

### 3. save_chapter_outline

```python
@register_action(
    description="ä¿å­˜ç« èŠ‚å¤§çº²ï¼ˆä¼šè‡ªåŠ¨æ ¡éªŒæ ¼å¼ï¼šæ¯è¡Œå¿…é¡»ä»¥ # å¼€å¤´ï¼Œè‡³å°‘2ç« ï¼‰"
)
async def save_chapter_outline(self, outline: str) -> str:
    """
    ä¿å­˜ç« èŠ‚å¤§çº²

    - æ ¼å¼ï¼šHeading one åˆ—è¡¨ï¼Œæ¯è¡Œä»¥ # å¼€å¤´
    - æ ¡éªŒï¼šæ¯è¡Œä»¥ # å¼€å¤´ï¼Œè‡³å°‘ 2 ç« 
    - ä¿å­˜åˆ°ï¼šctx.chapter_outline (List[str])
    - è‡ªåŠ¨åœ¨ notebook ä¸­åˆ›å»ºç« èŠ‚
    """
```

**ç‰¹ç‚¹**ï¼š
- âœ… Markdown heading one æ ¼å¼
- âœ… è‡³å°‘ 2 ä¸ªç« èŠ‚
- âœ… è‡ªåŠ¨åˆ›å»º notebook ç« èŠ‚
- âœ… åªåšæ ¼å¼æ ¡éªŒï¼Œä¸åšè¯­ä¹‰æ£€æŸ¥

### 4. consult_with_director

```python
@register_action(
    description="å’¨è¯¢å¯¼å¸ˆè·å–ç ”ç©¶è®¡åˆ’çš„å»ºè®®å’Œåé¦ˆï¼ˆè‡ªåŠ¨æ£€æŸ¥å½“å‰è®¡åˆ’çŠ¶æ€ï¼‰"
)
async def consult_with_director(self) -> str:
    """
    å’¨è¯¢å¯¼å¸ˆè·å–å»ºè®®

    - è‡ªåŠ¨æ£€æŸ¥ ctx çš„ä¸‰ä¸ªå­—æ®µçŠ¶æ€
    - å¦‚æœç¼ºå°‘æŸäº›éƒ¨åˆ†ï¼Œå¯¼å¸ˆä¼šæé†’è¡¥å……
    - å¦‚æœå·²æœ‰å†…å®¹ï¼Œå¯¼å¸ˆä¼šè¯„ä¼°å¹¶æä¾›å»ºè®®
    - è¯­ä¹‰è´¨é‡æ£€æŸ¥åœ¨è¿™é‡Œè¿›è¡Œ
    """
```

**ç‰¹ç‚¹**ï¼š
- âœ… **æ— å‚æ•°**ï¼šè‡ªåŠ¨æ£€æŸ¥ ctx çŠ¶æ€
- âœ… **æ™ºèƒ½åé¦ˆ**ï¼šæ ¹æ®å½“å‰è¿›åº¦ç»™å‡ºå»ºè®®
- âœ… **è¯­ä¹‰æ£€æŸ¥**ï¼šå¯¼å¸ˆè´Ÿè´£è¯„ä¼°å†…å®¹è´¨é‡

## å·¥ä½œæµç¨‹

### æ¨èçš„æ‰§è¡Œé¡ºåº

```
1. web_search (å¯é€‰) â†’ è¡¥å……çŸ¥è¯†
2. save_blueprint_overview â†’ è®°å½•ç ”ç©¶æƒ³æ³•
3. save_research_plan â†’ åˆ—å‡ºä»»åŠ¡æ­¥éª¤
4. save_chapter_outline â†’ è§„åˆ’ç« èŠ‚ç»“æ„
5. consult_with_director (å¯é€‰) â†’ è·å–å¯¼å¸ˆå»ºè®®
6. æ ¹æ®åé¦ˆä¿®æ”¹ä»»ä½•éƒ¨åˆ†
7. finish_task â†’ å®Œæˆè§„åˆ’
```

### çµæ´»çš„æ‰§è¡Œè·¯å¾„

```
è·¯å¾„1ï¼ˆç®€å•ï¼‰ï¼š
  save_blueprint_overview â†’ save_research_plan â†’ save_chapter_outline â†’ finish_task

è·¯å¾„2ï¼ˆéœ€è¦å’¨è¯¢ï¼‰ï¼š
  save_blueprint_overview â†’ consult_with_director â†’ save_research_plan
  â†’ consult_with_director â†’ save_chapter_outline â†’ finish_task

è·¯å¾„3ï¼ˆéœ€è¦æœç´¢ï¼‰ï¼š
  web_search â†’ web_search â†’ save_blueprint_overview â†’ save_research_plan
  â†’ save_chapter_outline(æ ¼å¼é”™è¯¯) â†’ save_chapter_outline(ä¿®æ­£) â†’ finish_task
```

## æ ¼å¼æ ¡éªŒ vs è¯­ä¹‰æ ¡éªŒ

### æ ¼å¼æ ¡éªŒï¼ˆActions å†…åµŒï¼‰

**ç›®çš„**ï¼šç¡®ä¿æ•°æ®æ ¼å¼æ­£ç¡®
**ä½ç½®**ï¼šAction å†…éƒ¨
**è§¦å‘**ï¼šä¿å­˜æ—¶ç«‹å³æ ¡éªŒ
**é”™è¯¯å¤„ç†**ï¼šè¿”å›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯ï¼Œè¿›å…¥å¯¹è¯å†å²ï¼Œè§¦å‘è‡ªåŠ¨ä¿®æ­£

**ç¤ºä¾‹**ï¼š
```python
# æ ¼å¼é”™è¯¯
save_chapter_outline("ç¬¬ä¸€ç«  èƒŒæ™¯\nç¬¬äºŒç«  æ–¹æ³•")
# è¿”å›ï¼šâŒ ç« èŠ‚å¤§çº²æ ¼å¼é”™è¯¯ï¼šç¬¬ 1 è¡Œä¸ä»¥ # å¼€å¤´

# Agent è‡ªåŠ¨ä¿®æ­£
save_chapter_outline("# ç¬¬ä¸€ç«  èƒŒæ™¯\n# ç¬¬äºŒç«  æ–¹æ³•")
# è¿”å›ï¼šâœ… ç« èŠ‚å¤§çº²å·²ä¿å­˜
```

### è¯­ä¹‰æ ¡éªŒï¼ˆå¯¼å¸ˆè´Ÿè´£ï¼‰

**ç›®çš„**ï¼šè¯„ä¼°å†…å®¹è´¨é‡
**ä½ç½®**ï¼šconsult_with_director action
**è§¦å‘**ï¼šä¸»åŠ¨å’¨è¯¢æ—¶
**é”™è¯¯å¤„ç†**ï¼šæä¾›å»ºè®®å’Œæ”¹è¿›æ–¹å‘

**ç¤ºä¾‹**ï¼š
```
å¯¼å¸ˆè¯„ä¼°ï¼š
1. ç ”ç©¶ç›®çš„æ˜¯å¦æ˜ç¡®ï¼Ÿ
2. æ–¹æ³•æ˜¯å¦èƒ½å›ç­”ç ”ç©¶ç›®çš„ï¼Ÿ
3. ç¬¬ä¸€æ­¥æ˜¯å¦å…·æœ‰å¯æ“ä½œæ€§ï¼Ÿ
4. é¼“åŠ±ä¸ºä¸»ï¼ŒåŸºæœ¬å¯è¡Œå³å¯å¼€å§‹
```

## ä¼˜åŠ¿æ€»ç»“

### 1. èŒè´£åˆ†ç¦»

- **Actions**ï¼šæ ¼å¼æ ¡éªŒï¼ˆä»£ç è§„åˆ™ï¼‰
- **å¯¼å¸ˆ**ï¼šè¯­ä¹‰æ£€æŸ¥ï¼ˆæ™ºèƒ½è¯„ä¼°ï¼‰
- **Micro Agent**ï¼šè‡ªç”±å†³ç­–ï¼ˆè‡ªä¸»é€‰æ‹©ï¼‰

### 2. è‡ªç„¶é‡è¯•

```
æ ¼å¼é”™è¯¯ â†’ Action è¿”å›é”™è¯¯ â†’ è¿›å…¥å¯¹è¯å†å² â†’ Agent çœ‹åˆ°é”™è¯¯ â†’ è‡ªåŠ¨ä¿®æ­£
```

### 3. çµæ´»æ€§

- ä¸‰ä¸ªéƒ¨åˆ†å¯ä»¥ç‹¬ç«‹ä¿å­˜
- é¡ºåºå¯ä»¥è‡ªç”±è°ƒæ•´
- å¯ä»¥éšæ—¶å’¨è¯¢å¯¼å¸ˆ
- æ”¯æŒå¤šæ¬¡è¿­ä»£

### 4. æ¸…æ™°çš„æ•°æ®ç»“æ„

```python
# ç ”ç©¶è“å›¾
blueprint_overview: str  # è‡ªç”±æ–‡æœ¬
research_plan: List[str]  # ä»»åŠ¡åˆ—è¡¨
chapter_outline: List[str]  # ç« èŠ‚åˆ—è¡¨
```

## ä¸æ—§è®¾è®¡çš„å¯¹æ¯”

| ç»´åº¦ | æ—§è®¾è®¡ | æ–°è®¾è®¡ |
|------|--------|--------|
| **äº§å‡º** | ç ”ç©¶è®¡åˆ’ + ç« èŠ‚å¤§çº² + é—®é¢˜æ¸…å• | ç ”ç©¶è“å›¾ï¼ˆ3éƒ¨åˆ†ï¼‰ |
| **ç ”ç©¶è®¡åˆ’** | è‡ªç”±æ–‡æœ¬ | ä»»åŠ¡åˆ—è¡¨ |
| **é—®é¢˜æ¸…å•** | âœ— æœ‰ | âœ— å»æ‰ï¼ˆç®€åŒ–ï¼‰ |
| **æ ¡éªŒ** | Parser éªŒè¯ | Action å†…åµŒæ ¡éªŒ |
| **è¯­ä¹‰æ£€æŸ¥** | Director æ‰¹å‡† | å¯¼å¸ˆå»ºè®® |
| **çµæ´»æ€§** | å›ºå®šæµç¨‹ | Micro Agent |

## ä½¿ç”¨ç¤ºä¾‹

### å®Œæ•´çš„ Planning Stage è°ƒç”¨

```python
# åœ¨ deep_researcher.py ä¸­
result = await self._run_micro_agent(
    persona=ctx.researcher_persona,
    task=planning_task,
    available_actions=[
        "web_search",
        "consult_with_director",
        "save_blueprint_overview",
        "save_research_plan",
        "save_chapter_outline",
        "finish_task"
    ],
    max_steps=15
)

# ç»“æœä¿å­˜åœ¨ ctx ä¸­
print(ctx.blueprint_overview)  # è‡ªç”±æ–‡æœ¬
print(ctx.research_plan)  # ["ä»»åŠ¡1", "ä»»åŠ¡2", ...]
print(ctx.chapter_outline)  # ["ç« èŠ‚1", "ç« èŠ‚2", ...]
```

## æ€»ç»“

ç ”ç©¶è“å›¾çš„ä¸‰ä¸ªéƒ¨åˆ†è®¾è®¡ï¼š

1. **Blueprint Overview** - è‡ªç”±æ–‡æœ¬ï¼Œæƒ³æ³•è®°å½•
2. **Research Plan** - ä»»åŠ¡åˆ—è¡¨ï¼Œæ˜ç¡®æ­¥éª¤
3. **Chapter Outline** - ç« èŠ‚å¤§çº²ï¼Œè§„åˆ’ç»“æ„

é€šè¿‡ Micro Agent + å†…åµŒæ ¡éªŒ + å¯¼å¸ˆå»ºè®®ï¼Œå®ç°äº†ï¼š
- âœ… æ ¼å¼ä¿è¯ï¼ˆActions æ ¡éªŒï¼‰
- âœ… è´¨é‡ä¿è¯ï¼ˆå¯¼å¸ˆå»ºè®®ï¼‰
- âœ… çµæ´»æ€§ï¼ˆMicro Agentï¼‰
- âœ… è‡ªç„¶é‡è¯•ï¼ˆå¯¹è¯å†å²é©±åŠ¨ï¼‰

è¿™æ˜¯ä¸€ä¸ªä¼˜é›…ã€çµæ´»ã€å¯é çš„è®¾è®¡ï¼ğŸ¯
